<ul *ngIf="tasks else loading">
  <li *ngFor="let task of tasks" [class]="[
    points ? 'text-' + (task | taskColor:points[task._id]) : null,
    evaluations && editable ? 'list-unstyled' : null,
  ]">
    <input
      *ngIf="evaluations && editable"
      #check
      type="checkbox"
      class="form-check-input"
      [checked]="evaluations[task._id] && points?.[task._id] !== 0"
      [indeterminate]="!evaluations[task._id]"
      (change)="givePoints(task, check.checked ? task.points : 0)"
      [ngbTooltip]="'Click to give ' + (check.checked ? 0 : task.points) + ' points'"
    >
    {{task.description}}
    <span class="badge bg-{{task | taskColor:points?.[task._id]}}">
      <ng-container *ngIf="points">{{points[task._id]}} / </ng-container>
      {{task.points}}
    </span>
    <ng-container *ngIf="evaluations">
      <a
        *ngIf="evaluations[task._id] as evaluation"
        class="ms-1"
        [class.link-info]="evaluation.remark"
        [class.link-secondary]="!evaluation.remark"
        [class.bi-person]="evaluation.author !== 'Code Search'"
        [class.bi-robot]="evaluation.author === 'Code Search'"
        [ngbTooltip]="evaluation.remark + ' ~ ' + evaluation.author"
        [routerLink]="[task._id]"
        (click)="openTelemetry(task)"
      ></a>
      <a
        *ngIf="editable && !evaluations[task._id]"
        ngbTooltip="Create Evaluation"
        role="button"
        class="bi-plus-circle link-primary ms-1"
        [routerLink]="[task._id]"
        (click)="openTelemetry(task)"
      ></a>
    </ng-container>
    <app-task-list
      *ngIf="task.children.length"
      [tasks]="task.children"
      [evaluations]="evaluations"
      [editable]="editable"
      [points]="points"
    ></app-task-list>
  </li>
</ul>
<ng-template #loading>
  Loading...
</ng-template>
