<div class="container">
  <app-assignment-info [assignment]="assignment"></app-assignment-info>

  <div class="btn-group" role="group" aria-label="Actions">
    <a class="btn btn-primary" [routerLink]="['/assignments', assignment?._id, 'edit']">
      <i class="bi-pencil"></i>
      Edit Assignment
    </a>
    <button
      *ngIf="assignment?.classroom?.org && assignment?.classroom?.prefix"
      class="btn btn-success"
      ngbTooltip="Import Solutions from GitHub Classroom (requires Account linked to GitHub)"
      (click)="import()"
    >
      <i class="bi-download"></i>
      Import Solutions
    </button>
  </div>

  <ul ngbNav #nav="ngbNav" [activeId]="(activatedRoute.queryParams | async)?.['tab'] ?? 'solutions'" class="nav-tabs">
    <li ngbNavItem="tasks">
      <a ngbNavLink routerLink="." [queryParams]="{tab: 'tasks'}">
        Tasks
      </a>
      <ng-template ngbNavContent>
        <div class="container">
          <app-task-list [tasks]="assignment?.tasks"></app-task-list>
        </div>
      </ng-template>
    </li>
    <li ngbNavItem="sample">
      <a ngbNavLink routerLink="." [queryParams]="{tab: 'sample'}">
        Sample Solution
      </a>
      <ng-template ngbNavContent>
        <div class="container">
          <app-scenario-codemirror
            [content]="assignment?.solution ?? 'Loading...'"
            [readOnly]="true"
            [autoRefresh]="true"
          ></app-scenario-codemirror>
        </div>
      </ng-template>
    </li>
    <li ngbNavItem="share">
      <a ngbNavLink routerLink="." [queryParams]="{tab: 'share'}">
        Sharing
      </a>
      <ng-template ngbNavContent>
        <div class="container">
          <h5 class="card-title">
            Student Link
          </h5>
          <p>
            You can now give your students the following link:
          </p>
          <p *ngIf="('/assignments/' + assignment?._id) as link">
            <a class="text-monospace" [routerLink]="link">
              {{origin + link}}
            </a>
            <button type="button" class="btn btn-sm btn-outline-primary"
                    ngxClipboard *ngxClipboardIfSupported [cbContent]="origin + link">
              Copy
            </button>
          </p>
          <ng-container *ngIf="assignment && assignment.token">
            <hr/>
            <h5 class="card-title">
              Access Token
            </h5>
            <p>
              To view submissions on other devices, you may be asked for the following token.
              Please save it or write it down somewhere.
              <b>Keep this token secret, do not share it with students!</b>
            </p>
            <p>
              <span class="text-monospace">{{assignment?.token}}</span>
              <button type="button" class="btn btn-sm btn-outline-secondary"
                      ngxClipboard *ngxClipboardIfSupported [cbContent]="assignment?.token">
                Copy
              </button>
            </p>
            <hr/>
            <h5 class="card-title">
              Teaching Assistant Invitation
            </h5>
            <p>
              You can invite Teaching Assistants by giving them the following link.
              <b>It includes the Access Token, so keep the link secret and do not share it with students!</b>
            </p>
            <p *ngIf="('/assignments/' + assignment._id + '/solutions') as link">
              <a class="text-monospace" [routerLink]="link" [queryParams]="{atok: assignment.token}">
                {{origin + link + '?atok=' + assignment.token}}
              </a>
              <button type="button" class="btn btn-sm btn-outline-primary"
                      ngxClipboard *ngxClipboardIfSupported [cbContent]="origin + link + '?atok=' + assignment.token">
                Copy
              </button>
            </p>
          </ng-container>
        </div>
      </ng-template>
    </li>
    <li ngbNavItem="solutions">
      <a ngbNavLink routerLink="." [queryParams]="{tab: 'solutions'}">
        Solutions
      </a>
      <ng-template ngbNavContent>
        <app-solution-table></app-solution-table>
      </ng-template>
    </li>
  </ul>
</div>
<div [ngbNavOutlet]="nav"></div>
<router-outlet></router-outlet>
