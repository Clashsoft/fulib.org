<app-modal #modal [back]="['../..']" [backOptions]="{relativeTo: route, queryParams: {parent: null}}">
  <ng-container modal-header>
    Edit Task
  </ng-container>
  <ng-container modal-body>
    <div class="form mb-3">
      <div class="form-group row">
        <label for="task/{{task._id}}/descriptionInput" class="col-sm-2 col-form-label">Description</label>
        <div class="col-sm-10">
          <input type="text" class="form-control" id="task/{{task._id}}/descriptionInput"
                 [(ngModel)]="task.description">
        </div>
      </div>
      <div class="form-group row">
        <label for="task/{{task._id}}/pointsInput" class="col-sm-2 col-form-label">Points</label>
        <div class="col-sm-10">
          <div class="input-group">
            <input type="number" class="form-control" id="task/{{task._id}}/pointsInput" min="0"
                   [(ngModel)]="task.points">
            <div class="input-group-append" *ngIf="task.children.length">
              <button class="btn btn-outline-secondary" ngbTooltip="Calculate Automatically" (click)="calcPoints(task)">
                <i class="bi-magic"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
      <div class="form-group row">
        <label for="task/{{task._id}}/verificationInput" class="col-sm-2 col-form-label">Verification</label>
        <div class="col-sm-10">
          <app-scenario-codemirror
            id="task/{{task._id}}/verificationInput"
            [content]="task.verification"
            [autoRefresh]="true"
            [autoSubmit]="true"
          ></app-scenario-codemirror>
        </div>
      </div>
      <div class="form-group row" *ngIf="context.evaluations?.[task._id]?.remark as remark">
        <label for="task/{{task._id}}/output" class="col-sm-2 col-form-label">Output</label>
        <div class="col-sm-10">
          <app-autotheme-codemirror id="task/{{task._id}}/output" [content]="remark" [options]="{
            autoRefresh: true,
            lineNumbers: true,
            styleActiveLine: true
          }"></app-autotheme-codemirror>
        </div>
      </div>
    </div>
  </ng-container>
  <ng-container modal-footer>
    <button type="button" class="btn btn-secondary" (click)="modal.close()">
      Cancel
    </button>
    <button type="button" class="btn btn-primary" (click)="save(); modal.close()">
      Save
    </button>
  </ng-container>
</app-modal>
